@model MicroservicesOverviewViewModel
@{
    ViewData["Title"] = "Microservices Overview";
}

<div class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="display-3 fw-bold">@Model.Title</h1>
                <p class="lead">@Model.Description</p>
                <div class="d-flex gap-3">
                    <a asp-action="Architecture" class="btn btn-primary btn-lg">
                        <i class="fas fa-project-diagram me-2"></i>View Architecture
                    </a>
                    <a asp-action="CodeExamples" class="btn btn-outline-primary btn-lg">
                        <i class="fas fa-code me-2"></i>See Code Examples
                    </a>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="architecture-preview">
                    <svg viewBox="0 0 600 400" class="w-100">
                        <!-- Simplified architecture diagram -->
                        <rect x="0" y="0" width="600" height="400" fill="#f8f9fa" />
                        
                        <!-- Client Layer -->
                        <rect x="50" y="20" width="120" height="50" fill="#3498db" rx="5" />
                        <text x="110" y="50" text-anchor="middle" fill="white" font-size="14">Web App</text>
                        
                        <rect x="200" y="20" width="120" height="50" fill="#3498db" rx="5" />
                        <text x="260" y="50" text-anchor="middle" fill="white" font-size="14">Mobile App</text>
                        
                        <!-- API Gateway -->
                        <rect x="125" y="100" width="150" height="50" fill="#e74c3c" rx="5" />
                        <text x="200" y="130" text-anchor="middle" fill="white" font-size="14">API Gateway</text>
                        
                        <!-- Microservices -->
                        <rect x="20" y="180" width="100" height="40" fill="#2ecc71" rx="5" />
                        <text x="70" y="205" text-anchor="middle" fill="white" font-size="12">Product</text>
                        
                        <rect x="140" y="180" width="100" height="40" fill="#2ecc71" rx="5" />
                        <text x="190" y="205" text-anchor="middle" fill="white" font-size="12">Order</text>
                        
                        <rect x="260" y="180" width="100" height="40" fill="#2ecc71" rx="5" />
                        <text x="310" y="205" text-anchor="middle" fill="white" font-size="12">Customer</text>
                        
                        <!-- Azure Services -->
                        <rect x="400" y="100" width="150" height="40" fill="#0078d4" rx="5" />
                        <text x="475" y="125" text-anchor="middle" fill="white" font-size="12">Azure Services</text>
                        
                        <!-- Connections -->
                        <line x1="110" y1="70" x2="200" y2="100" stroke="#666" stroke-width="2" />
                        <line x1="260" y1="70" x2="200" y2="100" stroke="#666" stroke-width="2" />
                        <line x1="200" y1="150" x2="70" y2="180" stroke="#666" stroke-width="2" />
                        <line x1="200" y1="150" x2="190" y2="180" stroke="#666" stroke-width="2" />
                        <line x1="200" y1="150" x2="310" y2="180" stroke="#666" stroke-width="2" />
                    </svg>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container my-5">
    <h2 class="text-center mb-5">Microservices in Our Architecture</h2>
    
    <div class="row g-4">
        @foreach (var service in Model.Microservices)
        {
            <div class="col-md-6 col-lg-4">
                <div class="card h-100 service-card shadow-sm" data-service="@service.Name">
                    <div class="card-header" style="background-color: @service.Color; color: white;">
                        <h5 class="mb-0">
                            <span class="service-icon">@service.Icon</span>
                            @service.Name
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">@service.Description</p>
                        <h6>Technology:</h6>
                        <p class="small">@service.Technology</p>
                        <h6>Key APIs:</h6>
                        <ul class="list-unstyled small">
                            @foreach (var api in service.APIs.Take(3))
                            {
                                <li><code>@api</code></li>
                            }
                        </ul>
                        <a asp-action="Services" class="btn btn-sm btn-outline-primary">
                            View Details <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<div class="bg-light py-5">
    <div class="container">
        <h2 class="text-center mb-5">Azure Services Integration</h2>
        
        <div class="row g-4">
            @foreach (var azureService in Model.AzureServices)
            {
                <div class="col-md-6">
                    <div class="card h-100 azure-card shadow-sm">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-3">
                                <div class="azure-icon me-3">
                                    <span class="fs-2">@azureService.Icon</span>
                                </div>
                                <div>
                                    <h5 class="mb-1">@azureService.Name</h5>
                                    <span class="badge bg-azure">@azureService.Category</span>
                                </div>
                            </div>
                            <p class="text-muted">@azureService.Description</p>
                            <h6>Purpose:</h6>
                            <p class="small">@azureService.Purpose</p>
                            <a asp-action="AzureIntegration" class="btn btn-sm btn-azure">
                                <i class="fab fa-microsoft me-1"></i>Learn More
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<div class="container my-5">
    <h2 class="text-center mb-5">Key Patterns & Practices</h2>
    
    <div class="row g-4">
        @foreach (var pattern in Model.Patterns)
        {
            <div class="col-md-4">
                <div class="card h-100 pattern-card">
                    <div class="card-body text-center">
                        <div class="pattern-icon mb-3">
                            <i class="fas fa-shapes fa-3x text-primary"></i>
                        </div>
                        <h5>@pattern.Name</h5>
                        <span class="badge bg-secondary mb-2">@pattern.Category</span>
                        <p class="text-muted small">@pattern.Description</p>
                        <a asp-action="Patterns" class="btn btn-sm btn-outline-primary">
                            View Implementation
                        </a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<div class="architecture-diagram-section bg-dark text-white py-5">
    <div class="container">
        <h2 class="text-center mb-5">Complete Architecture Overview</h2>
        <div id="architecture-diagram" class="bg-white rounded p-4">
            <svg viewBox="0 0 800 700" class="w-100">
                @foreach (var layer in Model.Diagram.Layers)
                {
                    <rect x="0" y="@layer.Y" width="800" height="@layer.Height" 
                          fill="@layer.Color" opacity="0.1" />
                    @Html.Raw($"<text x=\"10\" y=\"{layer.Y + 20}\" font-size=\"14\" fill=\"#666\">{layer.Name}</text>")
                }
                
                @foreach (var component in Model.Diagram.Components)
                {
                    <g class="diagram-component" data-component="@component.Id">
                        <rect x="@component.X" y="@component.Y" width="@component.Width" height="@component.Height"
                              fill="@component.Color" rx="5" class="component-rect" />
                        <text x="@(component.X + component.Width/2)" y="@(component.Y + component.Height/2 + 5)"
                              text-anchor="middle" fill="white" font-size="14">
                            @component.Name
                        </text>
                    </g>
                }
                
                @foreach (var connection in Model.Diagram.Connections)
                {
                    var fromComponent = Model.Diagram.Components.First(c => c.Id == connection.From);
                    var toComponent = Model.Diagram.Components.First(c => c.Id == connection.To);
                    var textX = (fromComponent.X + toComponent.X + fromComponent.Width/2 + toComponent.Width/2)/2;
                    var textY = (fromComponent.Y + toComponent.Y + fromComponent.Height)/2;
                    
                    <line x1="@(fromComponent.X + fromComponent.Width/2)" 
                          y1="@(fromComponent.Y + fromComponent.Height)"
                          x2="@(toComponent.X + toComponent.Width/2)" 
                          y2="@toComponent.Y"
                          stroke="#666" stroke-width="2" 
                          marker-end="url(#arrowhead)"
                          class="@(connection.Type == "async" ? "async-connection" : "sync-connection")" />
                    
                    @Html.Raw($"<text x=\"{textX}\" y=\"{textY}\" text-anchor=\"middle\" font-size=\"10\" fill=\"#666\">{connection.Label}</text>")
                }
                
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
                            refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
                    </marker>
                </defs>
            </svg>
        </div>
        <div class="text-center mt-4">
            <a asp-action="Architecture" class="btn btn-light btn-lg">
                <i class="fas fa-expand me-2"></i>View Full Architecture
            </a>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add hover effects to service cards
            document.querySelectorAll('.service-card').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.classList.add('shadow-lg');
                    this.style.transform = 'translateY(-5px)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.classList.remove('shadow-lg');
                    this.style.transform = 'translateY(0)';
                });
            });
            
            // Add interactivity to architecture diagram
            document.querySelectorAll('.diagram-component').forEach(component => {
                component.addEventListener('click', function() {
                    const componentId = this.getAttribute('data-component');
                    console.log('Clicked component:', componentId);
                    // Could navigate to specific component details
                });
            });
        });
    </script>
}