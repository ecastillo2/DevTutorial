@model SqlQuery
@{
    ViewData["Title"] = "SQL Query Solution";
}

<h1 class="display-4 text-center mb-4">
    <i class="fas fa-code me-3"></i>SQL Query Solution
</h1>

<div class="alert alert-info mb-4">
    <i class="fas fa-info-circle me-2"></i>
    <strong>Query Objective:</strong> Find employees of First Bank Corporation earning more than $100,000
</div>

<div class="card shadow-lg mb-5">
    <div class="card-header bg-primary text-white">
        <h4 class="mb-0"><i class="fas fa-database me-2"></i>Main Query</h4>
    </div>
    <div class="card-body">
        <pre><code class="language-sql">@Model.MainQuery</code></pre>
    </div>
</div>

<h2 class="mb-4">Query Breakdown</h2>

<div class="row mb-5">
    <div class="col-md-6">
        <div class="card h-100 shadow">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-list me-2"></i>SELECT Clause</h5>
            </div>
            <div class="card-body">
                <pre><code class="language-sql">SELECT 
    e.first_name + ' ' + e.last_name AS employee_name,
    e.street_address,
    e.city</code></pre>
                <p class="mt-3">
                    <strong>Purpose:</strong> Retrieves the required information
                </p>
                <ul>
                    <li>Concatenates first and last name with a space</li>
                    <li>Aliases the result as 'employee_name'</li>
                    <li>Selects street address and city directly</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card h-100 shadow">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-link me-2"></i>FROM & JOIN Clauses</h5>
            </div>
            <div class="card-body">
                <pre><code class="language-sql">FROM 
    Employee e
    INNER JOIN Employment emp ON e.employee_id = emp.employee_id
    INNER JOIN Company c ON emp.company_id = c.company_id</code></pre>
                <p class="mt-3">
                    <strong>Purpose:</strong> Connects the three tables
                </p>
                <ul>
                    <li>Employee → Employment via employee_id</li>
                    <li>Employment → Company via company_id</li>
                    <li>Uses table aliases (e, emp, c) for clarity</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="card shadow mb-5">
    <div class="card-header bg-warning">
        <h5 class="mb-0"><i class="fas fa-filter me-2"></i>WHERE Clause</h5>
    </div>
    <div class="card-body">
        <pre><code class="language-sql">WHERE 
    c.company_name = 'First Bank Corporation'
    AND emp.salary > 100000
    AND emp.is_active = 1</code></pre>
        <div class="row mt-3">
            <div class="col-md-4">
                <h6>Company Filter</h6>
                <p><code>c.company_name = 'First Bank Corporation'</code></p>
                <p class="text-muted">Exact match on company name</p>
            </div>
            <div class="col-md-4">
                <h6>Salary Filter</h6>
                <p><code>emp.salary > 100000</code></p>
                <p class="text-muted">Greater than (not equal to) $100,000</p>
            </div>
            <div class="col-md-4">
                <h6>Status Filter</h6>
                <p><code>emp.is_active = 1</code></p>
                <p class="text-muted">Only current employees</p>
            </div>
        </div>
    </div>
</div>

<h2 class="mb-4">Alternative Approaches</h2>

<div class="accordion" id="alternativeQueries">
    @for (int i = 0; i < Model.AlternativeQueries.Count; i++)
    {
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button @(i > 0 ? "collapsed" : "")" type="button" data-bs-toggle="collapse" data-bs-target="#alternative@(i)">
                    Alternative @(i + 1): @(i == 0 ? "MySQL/PostgreSQL Syntax" : i == 1 ? "Subquery Approach" : "EXISTS Clause")
                </button>
            </h2>
            <div id="alternative@(i)" class="accordion-collapse collapse @(i == 0 ? "show" : "")" data-bs-parent="#alternativeQueries">
                <div class="accordion-body">
                    <pre><code class="language-sql">@Model.AlternativeQueries[i]</code></pre>
                </div>
            </div>
        </div>
    }
</div>

<div class="performance-tips mt-5">
    <h2 class="mb-4">Performance Optimization Tips</h2>
    <div class="row">
        <div class="col-md-6">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-secondary text-white">
                    <h6 class="mb-0"><i class="fas fa-bolt me-2"></i>Recommended Indexes</h6>
                </div>
                <div class="card-body">
                    <ul class="mb-0">
                        <li><code>CREATE INDEX IX_Company_Name ON Company(company_name)</code></li>
                        <li><code>CREATE INDEX IX_Employment_CompanyId_Salary ON Employment(company_id, salary) WHERE is_active = 1</code></li>
                        <li><code>CREATE INDEX IX_Employment_EmployeeId ON Employment(employee_id)</code></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-secondary text-white">
                    <h6 class="mb-0"><i class="fas fa-chart-line me-2"></i>Query Statistics</h6>
                </div>
                <div class="card-body">
                    <ul class="mb-0">
                        <li>Estimated execution time: 10-50ms</li>
                        <li>Index seeks preferred over table scans</li>
                        <li>Join order: Company → Employment → Employee</li>
                        <li>Cardinality estimation is crucial</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="text-center mt-5">
    <a asp-action="ExecuteQuery" class="btn btn-success btn-lg">
        <i class="fas fa-play me-2"></i>Execute Query
    </a>
</div>

@section Scripts {
    <script>
        // Syntax highlighting is handled by Prism.js loaded in _Layout
    </script>
}